<script>
    function loadTooltips() {
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    };
</script>
<div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title">Project Settings</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div class="row">
                {% with project_org=project.organizationprojects_set.first %}
                {% if project_org %}
                <p>Organization: <a href="{% url 'organization' project_org.id %}">{{ project_org.current.name }}</a></p>
                {% endif %}
                {% endwith %}
            </div>
            <div class="row">
                <div class="accordion" id="project-settings-accordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#project-settings-table-content" aria-expanded="true" aria-controls="project-settings-table-content">
                                Project Details
                            </button>
                        </h2>
                        <div id="project-settings-table-content" class="accordion-collapse collapse show" data-bs-parent="#project-settings-accordion">
                            <div class="accordion-body">
                                <form
                                    hx-post="{% url 'project' project_id %}"
                                    hx-target="#project-pane"
                                    data-bs-toggle="toast"
                                    data-bs-target="#project">
                                    {% csrf_token %}
                                    <table class="table table-hover">
                                        {{ project_form.as_table }}
                                    </table>
                                    <div class="modal-footer">
                                        <button
                                            type="submit"
                                            class="btn btn-primary"
                                            data-bs-toggle="modal"
                                            data-bs-target="#project-modal">
                                            Submit
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#project-settings-git-repository-content" aria-expanded="false" aria-controls="project-settings-git-repository-content">
                            Git Repositories
                            </button>
                        </h2>
                        <div id="project-settings-git-repository-content" class="accordion-collapse collapse" data-bs-parent="#project-settings-accordion">
                            <div class="accordion-body">
                                {% include "project/project/project_settings_git_repositories_table.html" %}
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#project-settings-users-content" aria-expanded="false" aria-controls="project-settings-users-content">
                                Users
                            </button>
                        </h2>
                        <div id="project-settings-users-content" class="accordion-collapse collapse" data-bs-parent="#project-settings-accordion">
                            <div class="accordion-body">
                                <div class="row">
                                    <table class="table table-striped table-hover" id="project-settings-users-table">
                                        <thead>
                                            <tr>
                                                <th scope="col">Last Name</th>
                                                <th scope="col">First Name</th>
                                                <th scope="col">Email</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        {% for user in project.users.all %}
                                        <tr>
                                            <td>{{ user.current.last_name }}</th>
                                            <td>{{ user.current.first_name }}</td>
                                            <td>{{ user.current.email }}</td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="7" class="text-muted">No users associated with this project.</td>  {% comment %} TODO: Link to a new one for this project {% endcomment %}
                                        </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
    </div>
    <script>
        new DataTable('#project-settings-users-table', {
            order: [[4, 'desc']],
            language: {
                emptyTable: 'No records found.',
            }
        });
        loadTooltips();
    </script>
</div>
