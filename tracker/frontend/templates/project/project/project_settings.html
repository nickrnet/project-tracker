{% load tz %}
<script>
    function loadTooltips() {
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    };
</script>
<div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Project "{{ project.current.name|safe }}" Settings</h3>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div class="row">
                <p>Created by: <a href="{% url 'user' project.created_by.id %}">{{ project.created_by.current.last_name }}, {{ project.created_by.current.first_name }}</a> on {{ project.created_on|timezone:logged_in_user.current.timezone }}</p>
            </div>
            <div class="row">
                {% with project_org=project.organizationprojects_set.first %}
                {% if project_org %}
                <p>Organization: <a href="{% url 'organization' project_org.id %}">{{ project_org.current.name }}</a></p>
                {% endif %}
                {% endwith %}
            </div>
            <div class="row">
                <div class="accordion" id="project-settings-accordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#project-settings-table-content" aria-expanded="true" aria-controls="project-settings-table-content">
                                Project Details
                            </button>
                        </h2>
                        <div id="project-settings-table-content" class="accordion-collapse collapse show" data-bs-parent="#project-settings-accordion">
                            <div class="accordion-body">
                                <form
                                    id="project-settings-form"
                                    hx-post="{% url 'project' project_id %}"
                                    hx-target="#project-pane"
                                    hx-trigger="submit">
                                    {% csrf_token %}
                                    <div class="row g-3">
                                        <div class="col">
                                            <label for="id_name" class="form-label">Name:</label>
                                            <input type="text" name="name" value="{{ project.current.name }}" class="form-control" id="id_name" required>
                                        </div>
                                    </div>
                                    <div class="row g-3">
                                        <div class="col">
                                            <label for="id_description" class="form-label">Description:</label>
                                            <textarea name="description" class="form-control" id="id_description">{{ project.current.description }}</textarea>
                                        </div>
                                    </div>
                                    <div class="row g-3">
                                        <div class="col-md-3">
                                            <label for="id_label" class="form-label">Label:</label>
                                            <input type="text" name="label" value="{{ project.label.current.name.name }}" class="form-control" id="id_label" required>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="id_is_active" class="form-label">Is active?</label>
                                            <input type="checkbox" name="is_active" class="form-check-input mt-9" id="id_is_active" {% if project.current.is_active %}checked{% endif %}>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="id_is_private" class="form-label">Is private?</label>
                                            <input type="checkbox" name="is_private" class="form-check-input mt-9" id="id_is_private" {% if project.current.is_private %}checked{% endif %}>
                                        </div>
                                    </div>
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <label for="id_start_date_month" class="form-label">Start date:</label>
                                            <select name="start_date_month" id="id_start_date_month">
                                                <option value="">-----</option>
                                                <option value="1" {% if project.current.start_date|date:"n" == "1" %}selected{% endif %}>January</option>
                                                <option value="2" {% if project.current.start_date|date:"n" == "2" %}selected{% endif %}>February</option>
                                                <option value="3" {% if project.current.start_date|date:"n" == "3" %}selected{% endif %}>March</option>
                                                <option value="4" {% if project.current.start_date|date:"n" == "4" %}selected{% endif %}>April</option>
                                                <option value="5" {% if project.current.start_date|date:"n" == "5" %}selected{% endif %}>May</option>
                                                <option value="6" {% if project.current.start_date|date:"n" == "6" %}selected{% endif %}>June</option>
                                                <option value="7" {% if project.current.start_date|date:"n" == "7" %}selected{% endif %}>July</option>
                                                <option value="8" {% if project.current.start_date|date:"n" == "8" %}selected{% endif %}>August</option>
                                                <option value="9" {% if project.current.start_date|date:"n" == "9" %}selected{% endif %}>September</option>
                                                <option value="10" {% if project.current.start_date|date:"n" == "10" %}selected{% endif %}>October</option>
                                                <option value="11" {% if project.current.start_date|date:"n" == "11" %}selected{% endif %}>November</option>
                                                <option value="12" {% if project.current.start_date|date:"n" == "12" %}selected{% endif %}>December</option>
                                            </select>
                                            <select name="start_date_day" id="id_start_date_day">
                                                <option value="">-----</option>
                                                <option value="1" {% if project.current.start_date|date:"j" == "1" %}selected{% endif %}>1</option>
                                                <option value="2" {% if project.current.start_date|date:"j" == "2" %}selected{% endif %}>2</option>
                                                <option value="3" {% if project.current.start_date|date:"j" == "3" %}selected{% endif %}>3</option>
                                                <option value="4" {% if project.current.start_date|date:"j" == "4" %}selected{% endif %}>4</option>
                                                <option value="5" {% if project.current.start_date|date:"j" == "5" %}selected{% endif %}>5</option>
                                                <option value="6" {% if project.current.start_date|date:"j" == "6" %}selected{% endif %}>6</option>
                                                <option value="7" {% if project.current.start_date|date:"j" == "7" %}selected{% endif %}>7</option>
                                                <option value="8" {% if project.current.start_date|date:"j" == "8" %}selected{% endif %}>8</option>
                                                <option value="9" {% if project.current.start_date|date:"j" == "9" %}selected{% endif %}>9</option>
                                                <option value="10" {% if project.current.start_date|date:"j" == "10" %}selected{% endif %}>10</option>
                                                <option value="11" {% if project.current.start_date|date:"j" == "11" %}selected{% endif %}>11</option>
                                                <option value="12" {% if project.current.start_date|date:"j" == "12" %}selected{% endif %}>12</option>
                                                <option value="13" {% if project.current.start_date|date:"j" == "13" %}selected{% endif %}>13</option>
                                                <option value="14" {% if project.current.start_date|date:"j" == "14" %}selected{% endif %}>14</option>
                                                <option value="15" {% if project.current.start_date|date:"j" == "15" %}selected{% endif %}>15</option>
                                                <option value="16" {% if project.current.start_date|date:"j" == "16" %}selected{% endif %}>16</option>
                                                <option value="17" {% if project.current.start_date|date:"j" == "17" %}selected{% endif %}>17</option>
                                                <option value="18" {% if project.current.start_date|date:"j" == "18" %}selected{% endif %}>18</option>
                                                <option value="19" {% if project.current.start_date|date:"j" == "19" %}selected{% endif %}>19</option>
                                                <option value="20" {% if project.current.start_date|date:"j" == "20" %}selected{% endif %}>20</option>
                                                <option value="21" {% if project.current.start_date|date:"j" == "21" %}selected{% endif %}>21</option>
                                                <option value="22" {% if project.current.start_date|date:"j" == "22" %}selected{% endif %}>22</option>
                                                <option value="23" {% if project.current.start_date|date:"j" == "23" %}selected{% endif %}>23</option>
                                                <option value="24" {% if project.current.start_date|date:"j" == "24" %}selected{% endif %}>24</option>
                                                <option value="25" {% if project.current.start_date|date:"j" == "25" %}selected{% endif %}>25</option>
                                                <option value="26" {% if project.current.start_date|date:"j" == "26" %}selected{% endif %}>26</option>
                                                <option value="27" {% if project.current.start_date|date:"j" == "27" %}selected{% endif %}>27</option>
                                                <option value="28" {% if project.current.start_date|date:"j" == "28" %}selected{% endif %}>28</option>
                                                <option value="29" {% if project.current.start_date|date:"j" == "29" %}selected{% endif %}>29</option>
                                                <option value="30" {% if project.current.start_date|date:"j" == "30" %}selected{% endif %}>30</option>
                                                <option value="31" {% if project.current.start_date|date:"j" == "31" %}selected{% endif %}>31</option>
                                            </select>
                                            <select name="start_date_year" id="id_start_date_year">
                                                <option value="">-----</option>
                                                <option value="2020" {% if project.current.start_date|date:"Y" == "2020" %}selected{% endif %}>2020</option>
                                                <option value="2021" {% if project.current.start_date|date:"Y" == "2021" %}selected{% endif %}>2021</option>
                                                <option value="2022" {% if project.current.start_date|date:"Y" == "2022" %}selected{% endif %}>2022</option>
                                                <option value="2023" {% if project.current.start_date|date:"Y" == "2023" %}selected{% endif %}>2023</option>
                                                <option value="2024" {% if project.current.start_date|date:"Y" == "2024" %}selected{% endif %}>2024</option>
                                                <option value="2025" {% if project.current.start_date|date:"Y" == "2025" %}selected{% endif %}>2025</option>
                                                <option value="2026" {% if project.current.start_date|date:"Y" == "2026" %}selected{% endif %}>2026</option>
                                                <option value="2027" {% if project.current.start_date|date:"Y" == "2027" %}selected{% endif %}>2027</option>
                                                <option value="2028" {% if project.current.start_date|date:"Y" == "2028" %}selected{% endif %}>2028</option>
                                                <option value="2029" {% if project.current.start_date|date:"Y" == "2029" %}selected{% endif %}>2029</option>
                                                <option value="2030" {% if project.current.start_date|date:"Y" == "2030" %}selected{% endif %}>2030</option>
                                                <option value="2031" {% if project.current.start_date|date:"Y" == "2031" %}selected{% endif %}>2031</option>
                                                <option value="2032" {% if project.current.start_date|date:"Y" == "2032" %}selected{% endif %}>2032</option>
                                                <option value="2033" {% if project.current.start_date|date:"Y" == "2033" %}selected{% endif %}>2033</option>
                                                <option value="2034" {% if project.current.start_date|date:"Y" == "2034" %}selected{% endif %}>2034</option>
                                                <option value="2035" {% if project.current.start_date|date:"Y" == "2035" %}selected{% endif %}>2035</option>
                                                <option value="2036" {% if project.current.start_date|date:"Y" == "2036" %}selected{% endif %}>2036</option>
                                                <option value="2037" {% if project.current.start_date|date:"Y" == "2037" %}selected{% endif %}>2037</option>
                                                <option value="2038" {% if project.current.start_date|date:"Y" == "2038" %}selected{% endif %}>2038</option>
                                                <option value="2039" {% if project.current.start_date|date:"Y" == "2039" %}selected{% endif %}>2039</option>
                                                <option value="2040" {% if project.current.start_date|date:"Y" == "2040" %}selected{% endif %}>2040</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="id_end_date_month" class="form-label">End date:</label>
                                            <select name="end_date_month" id="id_end_date_month">
                                                <option value="">-----</option>
                                                <option value="1">January</option>
                                                <option value="2">February</option>
                                                <option value="3">March</option>
                                                <option value="4">April</option>
                                                <option value="5">May</option>
                                                <option value="6">June</option>
                                                <option value="7">July</option>
                                                <option value="8">August</option>
                                                <option value="9">September</option>
                                                <option value="10">October</option>
                                                <option value="11">November</option>
                                                <option value="12">December</option>
                                            </select>
                                            <select name="end_date_day" id="id_end_date_day">
                                                <option value="">-----</option>
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10">10</option>
                                                <option value="11">11</option>
                                                <option value="12">12</option>
                                                <option value="13">13</option>
                                                <option value="14">14</option>
                                                <option value="15">15</option>
                                                <option value="16">16</option>
                                                <option value="17">17</option>
                                                <option value="18">18</option>
                                                <option value="19">19</option>
                                                <option value="20">20</option>
                                                <option value="21">21</option>
                                                <option value="22">22</option>
                                                <option value="23">23</option>
                                                <option value="24">24</option>
                                                <option value="25">25</option>
                                                <option value="26">26</option>
                                                <option value="27">27</option>
                                                <option value="28">28</option>
                                                <option value="29">29</option>
                                                <option value="30">30</option>
                                                <option value="31">31</option>
                                            </select>
                                            <select name="end_date_year" id="id_end_date_year">
                                                <option value="">-----</option>
                                                <option value="2020">2020</option>
                                                <option value="2021">2021</option>
                                                <option value="2022">2022</option>
                                                <option value="2023">2023</option>
                                                <option value="2024">2024</option>
                                                <option value="2025">2025</option>
                                                <option value="2026">2026</option>
                                                <option value="2027">2027</option>
                                                <option value="2028">2028</option>
                                                <option value="2029">2029</option>
                                                <option value="2030">2030</option>
                                                <option value="2031">2031</option>
                                                <option value="2032">2032</option>
                                                <option value="2033">2033</option>
                                                <option value="2034">2034</option>
                                                <option value="2035">2035</option>
                                                <option value="2036">2036</option>
                                                <option value="2037">2037</option>
                                                <option value="2038">2038</option>
                                                <option value="2039">2039</option>
                                                <option value="2040">2040</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button
                                            type="submit"
                                            class="btn btn-primary"
                                            data-bs-toggle="modal"
                                            data-bs-target="#project-modal"
                                            form="project-settings-form">
                                            Submit
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#project-settings-git-repository-content" aria-expanded="false" aria-controls="project-settings-git-repository-content">
                            Git Repositories
                            </button>
                        </h2>
                        <div id="project-settings-git-repository-content" class="accordion-collapse collapse" data-bs-parent="#project-settings-accordion">
                            <div class="accordion-body">
                                {% include "project/project/project_settings_git_repositories_table.html" %}
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#project-settings-users-content" aria-expanded="false" aria-controls="project-settings-users-content">
                                Users
                            </button>
                        </h2>
                        <div id="project-settings-users-content" class="accordion-collapse collapse" data-bs-parent="#project-settings-accordion">
                            <div class="accordion-body">
                                <div class="row">
                                    <table class="table table-striped table-hover" id="project-settings-users-table">
                                        <thead>
                                            <tr>
                                                <th scope="col">Last Name</th>
                                                <th scope="col">First Name</th>
                                                <th scope="col">Email</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        {% for user in project.users.all %}
                                        <tr>
                                            <td>{{ user.current.last_name }}</th>
                                            <td>{{ user.current.first_name }}</td>
                                            <td>{{ user.current.email }}</td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="7" class="text-muted">No users associated with this project.</td>  {% comment %} TODO: Link to a new one for this project {% endcomment %}
                                        </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
    </div>
    <script>
        new DataTable('#project-settings-users-table', {
            order: [[4, 'desc']],
            language: {
                emptyTable: 'No records found.',
            },
            drawCallback: function (settings) {
                loadTooltips();
            },
        });
    </script>
</div>
